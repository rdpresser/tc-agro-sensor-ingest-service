{
  "PathBase": null,
  "Database": {
    "Postgres": {
      "Host": "tc-agro-postgres",
      "Port": 5432,
      "Database": "tc-agro-ingestion-db",
      "MaintenanceDatabase": "postgres",
      "UserName": "${DB_USERNAME}",
      "Password": "${DB_PASSWORD}",
      "Schema": "public",
      "ConnectionTimeout": 30,
      "MinPoolSize": 2,
      "MaxPoolSize": 20
    }
  },
  "Cache": {
    "Redis": {
      "Host": "tc-agro-redis",
      "Port": 6379,
      "Password": ""
    }
  },
  "Messaging": {
    "RabbitMQ": {
      "Host": "tc-agro-rabbitmq",
      "Port": 5672,
      "ManagementPort": 15672,
      "VirtualHost": "/",
      "Exchange": "sensor-ingest.events",
      "UserName": "${RABBITMQ_USERNAME}",
      "Password": "${RABBITMQ_PASSWORD}",
      "AutoProvision": true,
      "Durable": true,
      "UseQuorumQueues": false,
      "AutoPurgeOnStartup": false
    }
  },
  "Services": {
    "Identity": {
      "HttpPort": 5001
    },
    "Farm": {
      "HttpPort": 5002
    },
    "SensorIngest": {
      "HttpPort": 5003
    },
    "AnalyticsWorker": {
      "HttpPort": 5004
    },
    "Dashboard": {
      "HttpPort": 5005
    }
  },
  "Auth": {
    "Jwt": {
      "SecretKey": "${JWT_SECRET_KEY}",
      "Issuer": "tc-agro-identity-service",
      "Audience": [
        "tc-agro-sensor-ingest-service"
      ],
      "ExpirationInMinutes": 480
    }
  },
  "Logging": {
    "LogLevel": {
      "Wolverine": "Warning",
      "Default": "Information",
      "System.Net.Http.HttpClient": "Warning",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "Telemetry": {
    "Grafana": {
      "_comment": "FALLBACK ONLY - ConfigMap provides env vars that override these values in k3d cluster. These values are safe defaults for production scenarios.",
      "Agent": {
        "Host": "otel-collector-agent.observability.svc.cluster.local",
        "OtlpGrpcPort": 4317,
        "OtlpHttpPort": 4318,
        "MetricsPort": 8889,
        "Enabled": true,
        "_comment": "FALLBACK: k3d cluster uses DaemonSet service. ConfigMap will override via Telemetry__Grafana__Agent__Host env var."
      },
      "Otlp": {
        "Endpoint": "http://otel-collector-agent.observability.svc.cluster.local:4317",
        "Protocol": "grpc",
        "Headers": null,
        "TimeoutSeconds": 10,
        "Insecure": true,
        "_comment": "FALLBACK: For traces/metrics via OpenTelemetry SDK. ConfigMap will override via Telemetry__Grafana__Otlp__* env vars."
      }
    }
  },
  "Serilog": {
    "_comment": "Production/k3d: Serilog outputs to Console (Compact JSON) AND OpenTelemetry Collector via OTLP. OTEL DaemonSet receives on 4317 and routes to Loki. UseCustomSerilog() adds semantic enrichers (trace_id, span_id, service.name).",
    "Using": [ "Serilog.Sinks.Console", "Serilog.Formatting.Compact", "Serilog.Sinks.OpenTelemetry" ],
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "System": "Warning",
        "Microsoft.EntityFrameworkCore": "Information"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "formatter": "Serilog.Formatting.Compact.CompactJsonFormatter, Serilog.Formatting.Compact",
          "restrictedToMinimumLevel": "Information"
        }
      },
      {
        "Name": "OpenTelemetry",
        "Args": {
          "endpoint": "http://otel-collector-agent.observability.svc.cluster.local:4318/v1/logs",
          "protocol": "HttpProtobuf",
          "includeProperties": true,
          "includeFormattedMessage": true,
          "resourceAttributes": {
            "service.name": "tc-agro-sensor-ingest",
            "service.namespace": "tc-agro",
            "deployment.environment": "production"
          },
          "restrictedToMinimumLevel": "Information"
        }
      }
    ],
    "Enrich": [
      "FromLogContext",
      "WithMachineName",
      "WithThreadId"
    ]
  }
}
